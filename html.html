<!DOCTYPE html>
<html>
<head>
    <title>Gerar QR Code PIX</title>
</head>
<body>
    <div id="main-content">
        <h1 id="h1-pix">Gerar QR Code PIX</h1>
        <div id="qr-code-content">
            <input type="number" id="pix_value" placeholder="Digite o valor" required>
            <button id="generate_qr_code_button">Gerar QR Code</button>
        </div>
        
        <div id="qr-code-container"></div>
        
        <button id="copy_payload_button">Copiar Pix</button>
        <div id="copy_success_message" style="display: none; color: green;">Copiado com sucesso</div>
    
        <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
        <script>
            var payload = ""; // Variável para armazenar o valor do payload

            document.getElementById('generate_qr_code_button').addEventListener('click', function() {
                var pix_value = document.getElementById('pix_value').value;
                var pix_key = '+5532933006313'; // Nova chave PIX (formato celular)
    
                // Construa o payload PIX
                payload = '00020126360014BR.GOV.BCB.PIX0114' + pix_key + '5204000053039865405' + pix_value + '.00' + '5802BR5924PEDRO HENRIQUE LIMA DIAS6009SAO PAULO62130509pixcartao';
    
                // Calcula o CRC16 do payload PIX
                var crc16 = getCRC16(payload);
    
                // Converte o valor CRC16 em hexadecimal
                var crc16Hex = crc16.toString(16).toUpperCase();
    
                // Adicione o valor CRC16 ao final do payload PIX
                payload += '6304' + crc16Hex;
    
                // Crie um elemento para exibir o QR Code
                var qrcode = new QRCode(document.getElementById('qr-code-container'), {
                    text: payload.toString(),
                    width: 228,
                    height: 228
                });

                // Habilita o botão de copiar payload após a geração do QR Code
                document.getElementById('copy_payload_button').disabled = false;
            });

            document.getElementById('copy_payload_button').addEventListener('click', function() {
                // Copie o valor do payload para a área de transferência
                var tempInput = document.createElement("input");
                tempInput.value = payload;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand("copy");
                document.body.removeChild(tempInput);

                // Exiba a mensagem de sucesso
                var copySuccessMessage = document.getElementById('copy_success_message');
                copySuccessMessage.style.display = 'block';

                // Oculte a mensagem após alguns segundos
                setTimeout(function() {
                    copySuccessMessage.style.display = 'none';
                }, 2000); // A mensagem será ocultada após 2 segundos (2000 milissegundos)
            });

            function getCRC16(payload) {
                payload += '6304';
                var polinomio = 0x1021;
                var resultado = 0xFFFF;
                var length = payload.length;
    
                for (var offset = 0; offset < length; offset++) {
                    resultado ^= (payload.charCodeAt(offset) << 8);
    
                    for (var bitwise = 0; bitwise < 8; bitwise++) {
                        if ((resultado <<= 1) & 0x10000) {
                            resultado ^= polinomio;
                        }
                        resultado &= 0xFFFF;
                    }
                }
    
                return resultado;
            }
        </script>
    </div>    

</body>

<style>
    #pix_value{border-radius: 5px; width: 50%;}
    #generate_qr_code_button{border-radius: 5px; border-color: black; color: black; background-color: white;}
    #qr-code-content{display: flex; flex-direction: row; gap: 15px;}
    #main-content{ display: flex; justify-content: center; flex-direction: column; align-items: center; border: solid 1px; border-radius: 10px; padding: 12px;}
    #copy_payload_button{border-color: black; background-color: white; color: black; width: 50%;}
    #qr-code-container{margin-top: 14px; margin-bottom: 14px;}
    #h1-pix{font-size: 30px;}
</style>

</html>
